<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">

<meta name="ICBM" content="19.0760, 72.8777">
<meta name="geo.position" content="19.0760;72.8777">
<meta name="geo.region" content="IN-MH">
<meta name="geo.placename" content="Mumbai">
<title>[post] ä½¿ç”¨ gcc å¼€å‘ STM32 | xym-ee</title>


        <link rel="stylesheet" href="/css/tailwind.min.ce97201a436e89554f6444624e62d4b32a48d70d124d557a1852401701ab43bc.css" type="text/css" integrity="sha256-zpcgGkNuiVVPZERiTmLUsypI1w0STVV6GFJAFwGrQ7w=" crossorigin="anonymous">

</head>

<body class="bg-gradient-to-r from-slate-900 to-slate-800 font-mono text-white">
  <div class="container mx-auto flex flex-col px-4 xl:w-8/12 sm:max-w-full">
    
  

  <header class="flex flex-row py-4" >

  



  <nav
    class="flex flex-row items-center w-full justify-between">


  
  
    <div class="flex flex-col gap-1">
      <a href="https://xym.work/" class="text-4xl font-bold hover:text-sky-400 whitespace-nowrap">xym-ee</a>
      <p>Embedded Systems & Robot Control</p>
    </div>
  

  <div class="dropdown-menu flex flex-row absolute max-lg:w-full max-lg:items-center max-lg:justify-center max-lg:-top-full lg:static max-lg:bg-slate-900 max-lg:h-[calc(100dvh)] max-lg:left-0">
    <ul class="flex flex-col lg:flex-row gap-2">
      
  <li class="font-bold border border-sky-400 px-3 py-2 hover:bg-sky-400 focus:text-sky-400 text-center">
    <a href="/about.html">About</a>
  </li>

  <li class="font-bold border border-sky-400 px-3 py-2 hover:bg-sky-400 focus:text-sky-400 text-center">
    <a href="/gallery.html">Gallery</a>
  </li>

  <li class="font-bold border border-sky-400 px-3 py-2 hover:bg-sky-400 focus:text-sky-400 text-center">
    <a href="/blog">Blog</a>
  </li>

  <li class="font-bold border border-sky-400 px-3 py-2 hover:bg-sky-400 focus:text-sky-400 text-center">
    <a href="/notebook.html">Notebook</a>
  </li>

    </ul>
  </div>
  <div class="open-dropdown-button lg:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="32" height="32" fill="white">
      <path
        d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z" />
    </svg>
  </div>
  <div class="close-dropdown-button hidden z-50">
    <svg xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 384 512" width="32" height="32" fill="white">
      <path
        d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z" />
    </svg>
  </div>
</nav>
</header>

  
  <div class="flex flex-col pt-8 gap-10">
    
    <div class="flex flex-col w-full gap-4">
      <h2 class="text-3xl max-sm:text-2xl font-bold">[post] ä½¿ç”¨ gcc å¼€å‘ STM32</h2>
      
      <div class="flex flex-row flex-wrap max-md:gap-4 gap-10">
        <p>ğŸ“… 2024-09-04</p>
        
          <p>ğŸ”„ 2024-09-04</p>
        
        <p>âŒš Reading time: 3 min</p>
      </div>
      
      <div class="flex flex-row gap-2 flex-nowrap">
        <p class="py-1">ğŸ·ï¸</p>
<div class="flex flex-wrap gap-2">
  
    <a href='/tags/post'
    class="border border-sky-400 p-1 hover:bg-sky-400 focus:bg-sky-400 text-center">post</a>
  
    <a href='/tags/stm32'
    class="border border-sky-400 p-1 hover:bg-sky-400 focus:bg-sky-400 text-center">stm32</a>
  
    <a href='/tags/gcc'
    class="border border-sky-400 p-1 hover:bg-sky-400 focus:bg-sky-400 text-center">gcc</a>
  
    <a href='/tags/gdb'
    class="border border-sky-400 p-1 hover:bg-sky-400 focus:bg-sky-400 text-center">gdb</a>
  
    <a href='/tags/makefile'
    class="border border-sky-400 p-1 hover:bg-sky-400 focus:bg-sky-400 text-center">makefile</a>
  
    <a href='/tags/link'
    class="border border-sky-400 p-1 hover:bg-sky-400 focus:bg-sky-400 text-center">link</a>
  
</div>
      </div>
      <hr />
      <div class="flex flex-col gap-10">
        <div class="prose prose-invert max-w-full">
          <h1 id="ä½¿ç”¨-gcc-å¼€å‘-stm32">ä½¿ç”¨ gcc å¼€å‘ STM32</h1>
<p>æœ‰ keil IAR ç­‰ IDEï¼Œè¿˜è¦åœ¨ ubuntu ç¯å¢ƒä¸‹ä½¿ç”¨ gcc æ¥å¼€å‘ stm32 çœ‹èµ·æ¥ä¼¼ä¹åƒåŠ›ä¸è®¨å¥½ã€‚ä½†æ˜¯æŒæ¡è¿™ä¸ªæŠ€èƒ½çš„çœŸæ­£å«ä¹‰æ˜¯ï¼š</p>
<p>æ‹¿åˆ°ä»»æ„ä¸€å—ä½¿ç”¨ arm cortex-m å†…æ ¸çš„å…¨æ–°è®¾è®¡çš„èŠ¯ç‰‡ï¼Œåªæœ‰èŠ¯ç‰‡æ‰‹å†Œç”šè‡³è¿˜æ²¡æœ‰ IDE å¯ä»¥ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨ C è¯­è¨€å’Œä¸€äº› arm æ±‡ç¼–ï¼Œä»¥åŠäº¤å‰ç¼–è¯‘å·¥å…·ï¼Œæ˜¯å¯ä»¥æŠŠè¿™ä¸ªèŠ¯ç‰‡ä½¿ç”¨èµ·æ¥çš„ã€‚</p>
<p>æ›´å®é™…çš„æƒ…å†µæ˜¯ï¼Œä¸€äº›å¤§çš„è£¸æœºé¡¹ç›®æ¯”å¦‚ u-bootï¼Œç”šè‡³ linux kernel éƒ½æ˜¯æ²¡æœ‰ IDE ç”¨çš„ï¼Œå¼€å‘ã€è°ƒè¯•è¿™äº›é¡¹ç›®çš„å·¥å…·æ­£æ˜¯è£¸æœºå¼€å‘ stm32 çš„è¿™å¥—å·¥å…·ã€‚ä»ä¸€ä¸ªç®€å•çš„èŠ¯ç‰‡å¼€å§‹å»å­¦ä¹ è¿™ä¸€æµç¨‹ã€ç»ƒä¹ ç›¸åº”å·¥å…·çš„ä½¿ç”¨ã€‚</p>
<p>æˆ‘çš„ç¯å¢ƒ</p>
<ul>
<li>ubuntu 22.04</li>
<li>STM32F103C8T6 64K flash 20K ram</li>
<li>st-link v2</li>
<li>13.3.rel1-x86_64-arm-none-eabi</li>
</ul>
<h2 id="æœ€ç®€å•çš„ç¨‹åº">æœ€ç®€å•çš„ç¨‹åº</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">``</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ä¸ºäº†è®©è¿™ä¸ªå‡½æ•°èƒ½åœ¨</span> CPU <span style="color:#960050;background-color:#1e0010">ä¸Šæ‰§è¡Œï¼Œè¿˜éœ€è¦åšåˆ°èŠ¯ç‰‡é€šç”µåè·³è½¬åˆ°</span> main <span style="color:#960050;background-color:#1e0010">å…¥å£ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">```</span>c
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">__attribute__</span>((<span style="color:#66d9ef">naked</span>, noreturn)) <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">_reset</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">long</span> _sbss, _ebss, _sdata, _edata, _sidata;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>dst <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>_sbss; dst <span style="color:#f92672">&lt;</span> <span style="color:#f92672">&amp;</span>_ebss; dst<span style="color:#f92672">++</span>) 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>dst <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">long</span> <span style="color:#f92672">*</span>dst <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>_sdata, <span style="color:#f92672">*</span>src <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>_sidata; dst <span style="color:#f92672">&lt;</span> <span style="color:#f92672">&amp;</span>_edata;) 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>dst<span style="color:#f92672">++</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>src<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">main</span>();             <span style="color:#75715e">// Call main()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (;;) (<span style="color:#66d9ef">void</span>) <span style="color:#ae81ff">0</span>;  <span style="color:#75715e">// Infinite loop in the case if main() returns
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>æƒ³è®©è¿™ä¸ªå‡½æ•°é€šç”µå°±æ‰§è¡Œï¼Œéœ€è¦å‡†å¤‡å¥½ C è¯­è¨€çš„è¿è¡Œç¯å¢ƒï¼Œä»¥åŠæŒ‡å®šè¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼Œå³ç¨‹åºå‘˜å’Œç¡¬ä»¶çš„çº¦å®šï¼ŒæŸ¥çœ‹ m3 æƒå¨æŒ‡å—</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">_estack</span>(<span style="color:#66d9ef">void</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">__attribute__</span>((<span style="color:#a6e22e">section</span>(<span style="color:#e6db74">&#34;.vectors&#34;</span>))) <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> tab[<span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">60</span>])(<span style="color:#66d9ef">void</span>) <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    _estack,
</span></span><span style="display:flex;"><span>    _reset
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>æœ‰å¥½å¤šå˜é‡éƒ½ç”¨äº† extern ï¼Œè¿™äº›å˜é‡åœ¨é“¾æ¥è„šæœ¬å†…ï¼Œé“¾æ¥æ—¶ä¼šè®¡ç®—ç„¶åå¡«å…¥ã€‚æ­¤å¤–æœ‰å¥½å¤šä¿®é¥°ä¹Ÿæ˜¯ç»™è¿æ¥å™¨çœ‹çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">ENTRY</span>(_reset);
</span></span><span style="display:flex;"><span>MEMORY {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">flash</span>(rx)  <span style="color:#f92672">:</span> ORIGIN <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x08000000</span>, LENGTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>k
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sram</span>(rwx) <span style="color:#f92672">:</span> ORIGIN <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20000000</span>, LENGTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>k  <span style="color:#75715e">/* remaining 64k in a separate address space */</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>_estack     <span style="color:#f92672">=</span> <span style="color:#a6e22e">ORIGIN</span>(sram) <span style="color:#f92672">+</span> <span style="color:#a6e22e">LENGTH</span>(sram);    <span style="color:#75715e">/* stack points to end of SRAM */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SECTIONS {
</span></span><span style="display:flex;"><span>  .vectors  : { <span style="color:#a6e22e">KEEP</span>(<span style="color:#f92672">*</span>(.vectors)) }   <span style="color:#f92672">&gt;</span> flash
</span></span><span style="display:flex;"><span>  .text     : { <span style="color:#f92672">*</span>(.text<span style="color:#f92672">*</span>) }           <span style="color:#f92672">&gt;</span> flash
</span></span><span style="display:flex;"><span>  .rodata   : { <span style="color:#f92672">*</span>(.rodata<span style="color:#f92672">*</span>) }         <span style="color:#f92672">&gt;</span> flash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  .data : {
</span></span><span style="display:flex;"><span>    _sdata <span style="color:#f92672">=</span> .;   <span style="color:#75715e">/* .data section start */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>(.first_data)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>(.data <span style="color:#a6e22e">SORT</span>(.data.<span style="color:#f92672">*</span>))
</span></span><span style="display:flex;"><span>    _edata <span style="color:#f92672">=</span> .;  <span style="color:#75715e">/* .data section end */</span>
</span></span><span style="display:flex;"><span>  } <span style="color:#f92672">&gt;</span> sram AT <span style="color:#f92672">&gt;</span> flash
</span></span><span style="display:flex;"><span>  _sidata <span style="color:#f92672">=</span> <span style="color:#a6e22e">LOADADDR</span>(.data);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  .bss : {
</span></span><span style="display:flex;"><span>    _sbss <span style="color:#f92672">=</span> .;              <span style="color:#75715e">/* .bss section start */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>(.bss <span style="color:#a6e22e">SORT</span>(.bss.<span style="color:#f92672">*</span>) COMMON)
</span></span><span style="display:flex;"><span>    _ebss <span style="color:#f92672">=</span> .;              <span style="color:#75715e">/* .bss section end */</span>
</span></span><span style="display:flex;"><span>  } <span style="color:#f92672">&gt;</span> sram
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  . <span style="color:#f92672">=</span> <span style="color:#a6e22e">ALIGN</span>(<span style="color:#ae81ff">8</span>);
</span></span><span style="display:flex;"><span>  _end <span style="color:#f92672">=</span> .;     <span style="color:#75715e">/* for cmsis_gcc.h  */</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>é“¾æ¥è„šæœ¬æ§åˆ¶äº†ä»£ç å­˜æ”¾çš„ä½ç½®ã€‚</p>
<p>ç„¶åå°±å¯ä»¥å˜å¼‚äº†ã€‚å†™ä¸€ä¸ª makefile</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span>CFLAGS  <span style="color:#f92672">?=</span>  -W -Wall -Wextra -Werror -Wundef -Wshadow -Wdouble-promotion <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>            -Wformat-truncation -fno-common -Wconversion <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>            -g3 -Os -ffunction-sections -fdata-sections -I. <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>            -mcpu<span style="color:#f92672">=</span>cortex-m3 -mthumb <span style="color:#66d9ef">$(</span>EXTRA_CFLAGS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>LDFLAGS <span style="color:#f92672">?=</span> -Tlink.ld -nostartfiles -nostdlib --specs nano.specs -lc -lgcc -Wl,--gc-sections -Wl,-Map<span style="color:#f92672">=</span>$@.map
</span></span><span style="display:flex;"><span>SOURCES <span style="color:#f92672">=</span> main.c 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifeq</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#66d9ef">$(</span>OS<span style="color:#66d9ef">)</span><span style="color:#960050;background-color:#1e0010">,Windows_NT)</span>
</span></span><span style="display:flex;"><span>  RM <span style="color:#f92672">=</span> cmd /C del /Q /F
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">else</span>
</span></span><span style="display:flex;"><span>  RM <span style="color:#f92672">=</span> rm -f
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">build</span><span style="color:#f92672">:</span> firmware.bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">firmware.elf</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>SOURCES<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	arm-none-eabi-gcc <span style="color:#66d9ef">$(</span>SOURCES<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>CFLAGS<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>LDFLAGS<span style="color:#66d9ef">)</span> -o $@
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">firmware.bin</span><span style="color:#f92672">:</span> firmware.elf
</span></span><span style="display:flex;"><span>	arm-none-eabi-objcopy -O binary $&lt; $@
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">flash</span><span style="color:#f92672">:</span> firmware.bin
</span></span><span style="display:flex;"><span>	st-flash --reset write $&lt; 0x8000000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>RM<span style="color:#66d9ef">)</span> firmware.*
</span></span></code></pre></div><p>gcc å‚æ•°ä¸­å¤§éƒ¨åˆ†æ˜¯è­¦å‘Šæ§åˆ¶é€‰é¡¹ï¼Œæ­¤å¤–æŒ‡å®šäº†å†…æ ¸å‹å·ã€‚æ‰€æœ‰æ ‡å‡† gcc çš„å·¥å…·éƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œå¦‚ readelfã€objdumpï¼Œgdb ã€‚</p>
<h2 id="ä¸‹è½½å’Œè°ƒè¯•">ä¸‹è½½å’Œè°ƒè¯•</h2>
<p>ä¸‹è½½ä½¿ç”¨ st-link å·¥å…·åŒ…ã€‚è¿™ä¸ªå·¥å…·åŒ…é™¤äº† st-flash å·¥å…·è¿˜æœ‰ä¸€ä¸ª st-util å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥å¯åŠ¨ä¸€ä¸ª gdb server åœ¨ 4242 ç«¯å£ã€‚ç„¶åå°±å¯ä»¥ä½¿ç”¨ gdb å·¥å…·æ¥è°ƒè¯• STM32 äº†ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç ä¸‹è½½è¿›å»ä»¥åæ˜¯æ²¡æœ‰ä»»ä½•ç°è±¡çš„ã€‚æƒ³è¦çœ‹çœ‹ä»£ç æ˜¯ä¸æ˜¯çœŸçš„è¿è¡Œèµ·æ¥äº†ï¼Œéœ€è¦ç”¨åˆ°è°ƒè¯•å·¥å…·ã€‚</p>
<p>load åŠ è½½è¢«è°ƒè¯•çš„ç¨‹åºï¼Œç„¶åå‰©ä¸‹çš„æ“ä½œå°±æ˜¯ gdb çš„æ“ä½œã€‚</p>
<h2 id="ç‚¹äº®-led">ç‚¹äº® LED</h2>
<p>åˆ°äº† C è¯­è¨€çš„é¢†åŸŸï¼Œé‚£ä¹ˆå‡ ä¹å°±å¯ä»¥åšä»»ä½•äº‹æƒ…äº†ã€‚å…ˆç‚¹ä¸ªç¯</p>
<p>ç‚¹ç¯è¦åšçš„æ˜¯å¼€æ—¶é’Ÿï¼Œè®¾ç½® GPIO æ¨¡å¼ï¼Œç„¶åæ§åˆ¶å¼•è„šå¯„å­˜å™¨ã€‚å¯¹ç€æ‰‹å†Œå»å†™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> rcc {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">uint32_t</span> CR, CFGR, CIR, APB2RSTR, APB1RSTR, AHBENR, 
</span></span><span style="display:flex;"><span>                    APB2ENR, APB1ENR, BDCR, CSR;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> gpio {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">uint32_t</span> CRL, CRH, IDR, ODR, BSRR, BRR, LCKR;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">spin</span>(<span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">uint32_t</span> count) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (count<span style="color:#f92672">--</span>) <span style="color:#66d9ef">asm</span>(<span style="color:#e6db74">&#34;nop&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">gpio_write</span>(<span style="color:#66d9ef">uint8_t</span> val) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (val <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        GPIOC<span style="color:#f92672">-&gt;</span>BSRR <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">8</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        GPIOC<span style="color:#f92672">-&gt;</span>BSRR <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">24</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> rcc<span style="color:#f92672">*</span> rcc <span style="color:#f92672">=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x40021000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> gpioc<span style="color:#f92672">*</span> gpioc <span style="color:#f92672">=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#ae81ff">0x40011000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    rcc<span style="color:#f92672">-&gt;</span>APB2ENR <span style="color:#f92672">|=</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    gpioc<span style="color:#f92672">-&gt;</span>CRH <span style="color:#f92672">&amp;=</span> <span style="color:#f92672">~</span>(<span style="color:#ae81ff">0x0fU</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">20</span>);         <span style="color:#75715e">// Clear existing setting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    gpioc<span style="color:#f92672">-&gt;</span>CRH <span style="color:#f92672">|=</span> <span style="color:#ae81ff">0x20</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">16</span>;       <span style="color:#75715e">// Set new mode 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (;;) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gpio_write</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">spin</span>(<span style="color:#ae81ff">999999</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gpio_write</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">spin</span>(<span style="color:#ae81ff">999999</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åŠŸèƒ½æ˜¯å¯ä»¥å®ç°çš„ï¼Œä½†æ˜¯å¯è¯»æ€§ä¹Ÿæ˜¯å‡ ä¹æ²¡æœ‰çš„ã€‚ä½†æ˜¯è¿™é‡Œå·²ç»æœ‰ä¸€äº›å®˜æ–¹åº“çš„å½±å­äº†ã€‚</p>
<p>åŸç†ä¸Šæ˜¯è¿™äº›åŸç†ï¼ŒçœŸæ­£çš„æƒ³ç”¨èµ·æ¥ï¼Œè¿˜æœ‰éå¸¸å¤šçš„ç»†èŠ‚è¦å»è€ƒè™‘ã€‚</p>

          <hr />
        </div>
        <div>
          

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
    this.page.url = "https:\/\/xym.work\/blog\/baremetal.html";
    this.page.identifier = ""; 
    };
    (function () { 
      var d = document, s = d.createElement('script');
      s.src = 'https://xym.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>


        </div>
      </div>
    </div>

    <div class="footer flex items-center justify-center">
  <div class="py-4">
  <footer>
    <p class="whitespace-nowrap">Â© 2024. <a href="https://github.com/xym-ee" target="_blank">xym-ee
    </a> all rights reserved.</p>
  </footer>
</div>
</div>
  </div>
  

  </div>
  
        <script type="text/javascript" src="/js/navbar.min.a2e7a3db4f1b58e7616cfd31a099340a207d5b99d96df87f525f17c604e184c1.js" integrity="sha256-ouej208bWOdhbP0xoJk0CiB9W5nZbfh/Ul8XxgThhME=" crossorigin="anonymous"></script>

  <script id="dsq-count-scr" src="//nayanseth.disqus.com/count.js" async></script>
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$']],  
      displayMath: [['$$', '$$']]  
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>
    document.addEventListener('DOMContentLoaded', function() {
      const icon1 = document.getElementById('svgwechat');
      const tooltip1 = document.getElementById('wechattip');

      icon1.addEventListener('mouseenter', function(event) {
        const rect = icon1.getBoundingClientRect();

        
        tooltip1.style.left = `${rect.left + window.scrollX - 100}px`;
        tooltip1.style.top = `${rect.bottom + window.scrollY + 20}px`;

        tooltip1.style.display = 'block';
      });

      icon1.addEventListener('mouseleave', function() {
        tooltip1.style.display = 'none';
      });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
      const icon2 = document.getElementById('svgqq');
      const tooltip2 = document.getElementById('qqtip');

      icon2.addEventListener('mouseenter', function(event) {
        const rect = icon2.getBoundingClientRect();

        
        tooltip2.style.left = `${rect.left + window.scrollX -100 }px`;
        tooltip2.style.top = `${rect.bottom + window.scrollY + 20}px`;

        tooltip2.style.display = 'block';
      });

      icon2.addEventListener('mouseleave', function() {
        tooltip2.style.display = 'none';
      });
    });
</script>

</body>

</html>